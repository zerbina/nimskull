<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>Language specification</title>
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<script type="text/javascript" src="dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  if (toggleSwitch !== null) {
    toggleSwitch.addEventListener('change', switchTheme, false);
  }

  var currentTheme = localStorage.getItem('theme');
  if (!currentTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    currentTheme = 'dark';
  }
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark' && toggleSwitch !== null) {
      toggleSwitch.checked = true;
    }
  }
}

window.addEventListener('DOMContentLoaded', main);
</script>

</head>
<body>
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">Language specification</h1>
    <div class="admonition admonition-info"><span class="admonition-info-text"><b>Note:</b></span>
Language specification implementation is an ongoing effort tracked in the <a class="reference external" href="https://github.com/nim-works/nimskull/projects/2">GitHub project</a></div>
<p>There are many ideas of what we could change or where to go next, but those are often poorly thought out. The sheer volume of what we don't know about the existing system, good or bad, is so large we're working in the dark. This is a blindspot induced by the current state of the code base.</p>
<p>What we do know, with great certainty, is that we need tests that not only test things but also:</p>
<ul class="simple"><li>teach the reader</li>
<li>are a useful reasoning tools</li>
<li>remember decisions of the past</li>
<li>help uncover lost ideas</li>
<li>shine a light on dark corners and issues</li>
</ul>
<p>Going through the exercise of improving tests will address the blindspot and is going to teach all of us where to go next and which ideas are more likely to get us there.</p>
<p>A language specification defines what's allowed, disallowed, undefined, guaranteed, not guaranteed, and known failure modes. More than a written document, our language specification is executable that, to the maximum extent possible, performs automated conformance testing of candidate compilers. Along with test code codifying the specification, technical commentary describes to the reader the detailed aspects of the language. The scope of the specification is the language and potentially any compiler interfaces, but exclusive of the standard library unless necessary. The specification is structured such that concepts are introduced as late as possible, leading to a natural layering of language facilities that build upon the previous. This layering allows for incremental learning for author or consumer and natural path of progress for any compiler implementation as a software engineering project.</p>

<h1 id="rationale">Rationale</h1><p>The above is a highlevel description of the end goal. The specification is a tool within a continuously improving development cycle that reinforces quality, clear communication, development speed, and bold experimentation.</p>
<p>The biggest benefit will be upon conclusion of the project, but as it progresses the intended use of the specification is as follows:</p>
<ul class="simple"><li>document the language both as it is and make early decisions of what to no longer support due to issues explained through attempts at codification and testing</li>
<li>identify bugs, and if relatively straightforward, resolve them as the appropriate behaviour is specified</li>
<li>using the logical progression of concepts in the language, layering them upon each other in a progressive fashion, we will highlight the architecture of language features and spot potential simplifications of the language itself</li>
<li>provide an entry point for those wishing to contribute by way of clarifying the specification</li>
<li>and much more</li>
</ul>
<p>After the language specification is complete, the specification will be the undeniable source of truth and at the center of many or our processes:</p>
<ul class="simple"><li><em>reduce the burden of contribution and maintenance</em> - allow compiler developers to freely refactor and make bold changes with a strong assurance that the specification will be automatically checked</li>
<li><em>ongoing simplicity and quantifiable debate</em> - using the specification and seeing the impact of changes we can quantify the merit and simplicity of various proposals</li>
<li><em>less RFCs and other heavy processes and more code</em> - proposal of new features must work their way through the specification itself, allow the proposer, their collaborators, and others to see the impact not simply in some giant RFC, but executable code</li>
<li><em>regression tests</em> - as part of our CI we'll hae a continuous regression tests suite</li>
<li><em>clear communication of changes</em> - specifications can be diffed, older ones run against newer compilers and vice versa; tagging, reviews, and all the other tools many are familiar with are easily leveraged</li>
<li><em>teaching and education</em> - contributors and programmers alike can easily and gradually learn the language itself by way of the specification; not to the exclusion of our teaching materials of course</li>
</ul>

<h2 id="frequently-asked-questions">Frequently Asked Questions</h2><p><em>What are some examples to follow?</em></p>
<p>See the following:</p>
<ul class="simple"><li>Code: <a class="reference external" href="https://github.com/nim-works/nimskull/tree/devel/tests/lang">https://github.com/nim-works/nimskull/tree/devel/tests/lang</a> - implement language specification in form of proper tests</li>
<li>PR: <a class="reference external" href="https://github.com/nim-works/nimskull/pull/28">Specification tests PR1</a></li>
<li>PR: <a class="reference external" href="https://github.com/nim-works/nimskull/pull/43">Specification tests PR2</a></li>
<li>PR: <a class="reference external" href="https://github.com/nim-works/nimskull/pull/59">Specification tests PR3</a></li>
</ul>

<h1 id="implementation">Implementation</h1><p>Currenly, language specification is represented as a collection of tests in the <tt class="docutils literal"><span class="pre">tests/lang</span></tt> subdirectory. This test suite provides a set of tests that aim to fully describe the language features and interactions between them. It starts from the very basic elements (such as expressions, <tt class="docutils literal"><span class="pre">if</span></tt> statements, control flow) and advances through the various parts of the language.</p>
<p>These tests are written in a slightly 'detached' manner - instead of trying to specify the <em>existing</em> behavior, their main aim is to provide examples of the <em>correct</em> behavior. All other parts of the |nimskull| must try to converge with these tests as much as possible (that is - fix bugs that prevent correct-as-described-in-spec behavior).</p>
<p>For example, right now this code does not compile with a type mismatch error, but it <em>should</em> compile and run as expected. Because of this, we added a <tt class="docutils literal"><span class="pre">knownIssue</span></tt> field to the test specification (it contains a one-line summary of the issue.</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
description: '''
Generic constraints for enum and tuple fail to resolve (ambigouus call)
if explicit generic parameter is used. When called without explicit parameter
(type inferred from the argument), code compiles correctly.
'''
knownIssue: &quot;enum/tuple generic constraint fails to resolve (ambiguous)&quot;
errormsg: &quot;ambiguous call [...]&quot;
&quot;&quot;&quot;</span>

<span class="Keyword">proc</span> <span class="Identifier">store</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">:</span> <span class="Keyword">enum</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">target</span><span class="Punctuation">:</span> <span class="Identifier">T</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Keyword">discard</span>
<span class="Keyword">proc</span> <span class="Identifier">store</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">:</span> <span class="Keyword">tuple</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">target</span><span class="Punctuation">:</span> <span class="Identifier">T</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Keyword">discard</span>

<span class="Keyword">proc</span> <span class="Identifier">aux1</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">obj</span><span class="Punctuation">:</span> <span class="Identifier">T</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Identifier">store</span><span class="Punctuation">(</span><span class="Identifier">obj</span><span class="Punctuation">)</span>

<span class="Comment">## aux1 can run and compile correctly</span>
<span class="Identifier">aux1</span><span class="Punctuation">(</span><span class="Punctuation">(</span><span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">2</span><span class="Punctuation">)</span><span class="Punctuation">)</span>

<span class="Keyword">proc</span> <span class="Identifier">aux2</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">obj</span><span class="Punctuation">:</span> <span class="Identifier">T</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Identifier">store</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">obj</span><span class="Punctuation">)</span>

<span class="Comment">## aux2 fails compilation</span>
<span class="Identifier">aux2</span><span class="Punctuation">(</span><span class="Punctuation">(</span><span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">2</span><span class="Punctuation">)</span><span class="Punctuation">)</span></pre><div class="admonition admonition-info"><span class="admonition-info-text"><b>Note:</b></span>
Full error message is 302 characters wide at the moment, so it was trimmed to <tt class="docutils literal"><span class="pre">[...]</span></tt></div>
<p>You can think of a spec as an abstract set of tests targeting a hypothetical <em>fully correct</em> compiler - you should be able to take this specification and start writing your own |NimSkull| compiler from scratch, or adding a new backend.</p>
<p>Specification itself is separated into several categories -</p>
<ol class="simple"><li>Basics - fundamental language constructs such as identifiers, literals, comments, primitive types, control flow.</li>
<li>Core - User-defined data types, procedures, iterators, effect syste, templates, macros.</li>
<li>Module system</li>
<li>Warnings and hints - various compiler diagnostics with explanations</li>
<li>Pragmas - interop and other pragmas</li>
<li>Experimental - experimental features.</li>
</ol>
<p>Each specification directory contains a readme that goes into more details about how and <em>why</em> tests should be structured in a particular manner. </p>



    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2022-02-06 00:00:00 UTC</small>
      </div>
    </div>
  </div>
</div>
</body>
</html>
